# Triplet training configuration tailored to the current SLURM/MIG run.

[triplet_training]

# Data paths (absolute so the SLURM job can resolve them regardless of CWD)
train_parquet_path = "/home/awolson/scratch/spatial-building-embeddings/merged/train.parquet"
val_parquet_path = "/home/awolson/scratch/spatial-building-embeddings/merged/val.parquet"
difficulty_metadata_path = "/home/awolson/scratch/spatial-building-embeddings/difficulty/difficulty_metadata.parquet"
checkpoint_dir = "/home/awolson/scratch/spatial-building-embeddings/checkpoints/triplet"
output_embeddings_dir = "/home/awolson/scratch/spatial-building-embeddings/specialized_embeddings"

# Model architecture (matches the run captured in the logs)
input_dim = 768
hidden_dim = 512
num_hidden_layers = 1
hidden_dim_multiplier = 1.0
activation = "gelu"
output_dim = 256
dropout = 0.1
use_residual = true
use_layer_norm = true

# Training hyperparameters
batch_size = 256
num_epochs = 50
learning_rate = 0.0001
weight_decay = 0.00001
margin = 0.5
loss_distance = "euclidean"

# UCB sampler configuration
ucb_exploration_constant = 2.0
ucb_warmup_samples = 1000

# Training configuration
device = "cuda"
num_workers = 8        # increase workers to keep the H100 MIG slice busy
pin_memory = true
seed = 42

# Checkpointing and validation cadence
save_every_n_epochs = 5
validate_every_n_epochs = 1
early_stopping_patience = 3
retrieval_metric_top_k = [1, 5, 10]
retrieval_metric_max_queries = 512
retrieval_metric_per_building_limit = 4

# Logging
log_file = "/home/awolson/scratch/spatial-building-embeddings/logs/triplet_training.log"
log_every_n_batches = 100
wandb_enabled = true
wandb_project = "spatial-building-embeddings"
wandb_mode = "online"
